<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Atlasmera</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;background:#000;color:#fff;font-family:system-ui;text-align:center}
video,canvas{width:100%;max-height:60vh;background:#111}
button{padding:12px 18px;border-radius:999px;border:none;margin:5px;font-weight:900}
#controls{position:fixed;bottom:10px;left:0;right:0}
#gallery{max-height:200px;overflow:auto;background:#111;padding:5px}
.item{margin:6px;padding:6px;background:#222;border-radius:10px}
</style>
</head>
<body>

<h2>ğŸ“¸ Atlasmera</h2>
<video id="cam" autoplay playsinline></video>
<canvas id="shot" style="display:none;"></canvas>

<div id="controls">
  <button onclick="startNormal()">ğŸ¥ Normal</button>
  <button onclick="startSlow()">ğŸ¢ Slow</button>
  <button onclick="startFast()">âš¡ Fast</button>
  <button onclick="takePhoto()">ğŸ“· Foto</button>
  <button onclick="stopRec()">â¹ Durdur</button>
  <input type="file" id="music" accept="audio/*">
</div>

<h3>ğŸ“‚ Galeri</h3>
<div id="gallery"></div>

<script>
let stream, mediaRecorder, chunks=[], mode="normal";
const cam = document.getElementById("cam");
const gallery = document.getElementById("gallery");

navigator.mediaDevices.getUserMedia({video:true,audio:true}).then(s=>{
  stream=s; cam.srcObject=s;
});

function startNormal(){ mode="normal"; startRec(1); }
function startSlow(){ mode="slow"; startRec(0.5); }
function startFast(){ mode="fast"; startRec(2); }

function startRec(speed){
  chunks=[];
  mediaRecorder = new MediaRecorder(stream);
  mediaRecorder.ondataavailable = e=>chunks.push(e.data);
  mediaRecorder.onstop = saveVideo;
  mediaRecorder.start();
}

function stopRec(){
  if(mediaRecorder && mediaRecorder.state==="recording"){
    mediaRecorder.stop();
  }
}

function saveVideo(){
  const blob = new Blob(chunks,{type:"video/webm"});
  const url = URL.createObjectURL(blob);
  saveToMemory({type:"video",url});
}

function takePhoto(){
  const c=document.getElementById("shot");
  c.width=cam.videoWidth;
  c.height=cam.videoHeight;
  c.getContext("2d").drawImage(cam,0,0);
  const url=c.toDataURL("image/png");
  saveToMemory({type:"photo",url});
}

function saveToMemory(item){
  let data = JSON.parse(localStorage.getItem("atlasmera")||"[]");
  data.push(item);
  localStorage.setItem("atlasmera",JSON.stringify(data));
  loadGallery();
}

function loadGallery(){
  gallery.innerHTML="";
  let data = JSON.parse(localStorage.getItem("atlasmera")||"[]");
  data.forEach((it,i)=>{
    let div=document.createElement("div");
    div.className="item";
    if(it.type==="photo"){
      div.innerHTML=`<img src="${it.url}" width="100%"><br><button onclick="del(${i})">Sil</button>`;
    }else{
      div.innerHTML=`<video src="${it.url}" controls width="100%"></video><br><button onclick="del(${i})">Sil</button>`;
    }
    gallery.appendChild(div);
  });
}

function del(i){
  let data = JSON.parse(localStorage.getItem("atlasmera")||"[]");
  data.splice(i,1);
  localStorage.setItem("atlasmera",JSON.stringify(data));
  loadGallery();
}

loadGallery();
</script>
</body>
</html>
