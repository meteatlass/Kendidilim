<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Atlas Studious – Kasa</title>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="theme-color" content="#0f1220"/>
<style>
  html,body{margin:0;padding:0;background:#0f1220;color:#fff;font-family:system-ui,Arial}
  #splash{position:fixed;inset:0;display:grid;place-items:center;z-index:9;background:#0f1220;animation:fade 5s forwards}
  #splash h1{letter-spacing:3px;color:#00ffd5;font-size:36px}
  @keyframes fade{0%,70%{opacity:1}100%{opacity:0;visibility:hidden}}
  .wrap{padding:16px;max-width:1000px;margin:auto}
  .card{background:#14183a;border-radius:14px;padding:14px;margin-bottom:12px}
  h2{color:#00ffd5;margin:0 0 8px}
  input, textarea, select{width:100%;padding:10px;border-radius:10px;border:0;margin:6px 0}
  button{width:100%;padding:12px;border:0;border-radius:12px;background:#00ffd5;color:#000;font-weight:700;margin-top:8px}
  .ghost{background:#2b2f6a;color:#fff}
  .hide{display:none}
  .item{padding:8px 0;border-bottom:1px dashed rgba(255,255,255,.15)}
  .msg{background:#0b0e24;border-radius:10px;padding:8px;margin:6px 0}
  .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
</style>
</head>
<body>

<div id="splash"><h1>ATLAS STUDIOUS</h1></div>

<div class="wrap">
  <!-- Giriş -->
  <div id="login" class="card">
    <h2>Kullanıcı Adı</h2>
    <input id="username" placeholder="Örn: A77"/>
    <button onclick="login()">Giriş / Kayıt</button>
  </div>

  <!-- Bilgi Formu -->
  <div id="form" class="card hide">
    <h2>Bilgilerin (ilk girişte doldur)</h2>
    <div class="grid">
      <input id="email" placeholder="E-posta"/>
      <input id="pass" placeholder="Tablet/telefon şifresi (kullanıcı yazar)"/>
      <input id="i1" placeholder="Bilgi 1"/>
      <input id="i2" placeholder="Bilgi 2"/>
      <input id="i3" placeholder="Bilgi 3"/>
      <input id="i4" placeholder="Bilgi 4"/>
    </div>
    <h3>Kasa Şifresi (zorunlu)</h3>
    <input id="vaultSet" placeholder="Kasa şifresi belirle"/>
    <button onclick="saveInfo()">Kaydet & Kasaya Kilitle</button>
    <button class="ghost" onclick="logout()">Başka kullanıcı adıyla gir</button>
  </div>

  <!-- Kasa -->
  <div id="vault" class="card hide">
    <h2 id="vaultTitle">Kasa</h2>
    <div id="out"></div>
    <button onclick="lock()">Kilitle</button>
    <button class="ghost" onclick="logout()">Başka kullanıcı adıyla gir</button>
  </div>

  <!-- Kilit Aç -->
  <div id="unlock" class="card hide">
    <h2>Kasa Kilitli</h2>
    <input id="vaultPass" placeholder="Kasa şifresi"/>
    <button onclick="unlock()">Kasayı Aç</button>
    <button class="ghost" onclick="forgotPass()">Şifremi Unuttum</button>
    <button class="ghost" onclick="logout()">Başka kullanıcı adıyla gir</button>
  </div>

  <!-- Admin: Mesaj Gönder -->
  <div id="adminMsg" class="card hide">
    <h2>Uygulama Kurucusu – Mesaj Gönder</h2>
    <select id="toUser"></select>
    <textarea id="msgText" placeholder="Mesaj yaz..."></textarea>
    <button onclick="sendMsg()">Gönder</button>
  </div>

  <!-- Mesajlar -->
  <div id="userMsgs" class="card hide">
    <h2>Mesajlar</h2>
    <div id="msgs"></div>
  </div>
</div>

<script>
const $ = id => document.getElementById(id);
const getAll = () => JSON.parse(localStorage.getItem("vaultAll") || "{}");
const setAll = o => localStorage.setItem("vaultAll", JSON.stringify(o));
const getMsgs = () => JSON.parse(localStorage.getItem("msgs") || "{}");
const setMsgs = o => localStorage.setItem("msgs", JSON.stringify(o));

function resetViews(){
  ["login","form","vault","unlock","adminMsg","userMsgs"].forEach(id=>$(id).classList.add("hide"));
}

function login(){
  const name = $("username").value.trim();
  if(!name) return alert("Kullanıcı adı yaz");
  localStorage.setItem("user", name);
  resetViews();
  const all = getAll();

  if(name === "ATLAS77"){
    renderAllWithPass(all);
    showAdminMsgPanel(all);
    showUserMsgs("ATLAS77");
  } else if(all[name]){
    $("unlock").classList.remove("hide");
    showUserMsgs(name);
  } else {
    $("form").classList.remove("hide");
  }
}

function saveInfo(){
  const user = localStorage.getItem("user");
  const vaultPass = $("vaultSet").value;
  if(!vaultPass) return alert("Kasa şifresi zorunlu");
  const all = getAll();
  all[user] = {
    user,
    email: $("email").value,
    pass: $("pass").value,
    i1: $("i1").value,
    i2: $("i2").value,
    i3: $("i3").value,
    i4: $("i4").value,
    vaultPass
  };
  setAll(all);
  resetViews();
  renderOne(user);
  showUserMsgs(user);
}

function renderOne(name){
  const all = getAll();
  const d = all[name];
  $("vaultTitle").innerText = "Kasa – " + name;
  $("out").innerHTML = `
    <div class="item">
      <b>${d.user}:</b><br/>
      E-posta: ${d.email}<br/>
      Tablet/telefon şifresi: ${d.pass}<br/>
      Bilgi1: ${d.i1}<br/>
      Bilgi2: ${d.i2}<br/>
      Bilgi3: ${d.i3}<br/>
      Bilgi4: ${d.i4}
    </div>
  `;
  $("vault").classList.remove("hide");
}

function renderAllWithPass(all){
  $("vaultTitle").innerText = "Kasa – Tüm Kullanıcılar (Uygulama Kurucusu)";
  let html = "";
  Object.keys(all).forEach(k=>{
    const d = all[k];
    html += `
      <div class="item">
        <b>${d.user}:</b><br/>
        E-posta: ${d.email}<br/>
        Tablet/telefon şifresi: ${d.pass}<br/>
        Kasa şifresi: ${d.vaultPass}<br/>
        Bilgi1: ${d.i1}<br/>
        Bilgi2: ${d.i2}<br/>
        Bilgi3: ${d.i3}<br/>
        Bilgi4: ${d.i4}
      </div>
    `;
  });
  $("out").innerHTML = html || "<i>Henüz kayıt yok</i>";
  $("vault").classList.remove("hide");
}

function lock(){
  resetViews();
  $("unlock").classList.remove("hide");
}

function unlock(){
  const name = localStorage.getItem("user");
  const all = getAll();
  if(name === "ATLAS77"){
    renderAllWithPass(all);
    showAdminMsgPanel(all);
    showUserMsgs("ATLAS77");
    return;
  }
  const p = $("vaultPass").value;
  if(p === all[name]?.vaultPass){
    resetViews();
    renderOne(name);
    showUserMsgs(name);
  } else {
    alert("Şifre yanlış");
  }
}

function logout(){
  localStorage.removeItem("user");
  $("username").value = "";
  resetViews();
  $("login").classList.remove("hide");
}

function showAdminMsgPanel(all){
  const sel = $("toUser");
  sel.innerHTML = Object.keys(all).map(u=>`<option value="${u}">${u}</option>`).join("");
  $("adminMsg").classList.remove("hide");
}

function sendMsg(){
  const to = $("toUser").value;
  const text = $("msgText").value.trim();
  if(!to || !text) return alert("Kullanıcı seç ve mesaj yaz");
  const msgs = getMsgs();
  msgs[to] = msgs[to] || [];
  msgs[to].push({from:"Uygulama Kurucusu", text, at: new Date().toLocaleString()});
  msgs["ATLAS77"] = msgs["ATLAS77"] || [];
  msgs["ATLAS77"].push({from: to, text: "(Giden) " + text, at: new Date().toLocaleString()});
  setMsgs(msgs);
  $("msgText").value = "";
  showUserMsgs("ATLAS77");
}

function forgotPass(){
  const user = localStorage.getItem("user");
  if(!user) return;
  const msgs = getMsgs();
  msgs["ATLAS77"] = msgs["ATLAS77"] || [];
  msgs["ATLAS77"].push({
    from: user,
    text: "Şifremi unuttum. Yardım eder misin?",
    at: new Date().toLocaleString()
  });
  setMsgs(msgs);
  showUserMsgs("ATLAS77");
  alert("Talebin uygulama kurucusuna gönderildi.");
}

function showUserMsgs(name){
  const msgs = getMsgs();
  const arr = msgs[name] || [];
  $("msgs").innerHTML = arr.map(m=>`
    <div class="msg">
      <b>${m.from}</b> • ${m.at}<br/>
      ${m.text}
    </div>
  `).join("") || "<i>Mesaj yok</i>";
  $("userMsgs").classList.remove("hide");
}
</script>

</body>
</html>
